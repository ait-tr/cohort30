# Аспектно-ориентированное программирование (AOP)

**Аспектно-ориентированное программирование (AOP)** — это парадигма,
направленная на повышение модульности различных частей приложения за счет разделения *сквозных задач*.
Для этого к уже существующему коду добавляется дополнительного поведение, без изменений в изначальном коде.
*Аспектно-ориентированное программирование (AOP) помогает элегантно реализовать т.н. сквозные задачи приложения: логирование, мониторинг,
контроль доступа и т.п.

Ключевым элементом модульности в ООП является класс, тогда как в АОП это аспект.

<img src="https://www.javachinna.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/04/ccc-768x641.jpeg.webp">

Информацией о том, в каком сервисе применить тот или иной функционал, или не
применять его вовсе, не обладают ни сервисы, ни добавляемая функциональность.
Аспект "знает" какую и где функциональность подключить.

## Основные понятия

**Aspect** — модуль или класс, реализующий сквозную функциональность. Аспект изменяет
поведение остального кода, применяя Advice в Join-Point-ах, определенных некоторым
«срезом» (Pointcut).

**Pointcut (Срез)** — набор Join-Point.

**Join-Point (Точка соединения)** — точка в выполняемой программе, где следует применить Aspect.

**Advice (Совет)** — код, которой должно быть вызван из точки соединения.
Advice может быть выполнен до, после или вместо точки соединения.

**Внедрение (introduction)** — изменение структуры класса и/или изменение иерархии наследования для
добавления функциональности аспекта в инородный код.

Таким образом, Аспект, обладая информацией (получаемой от Advice ), разрывает выполнение
программного кода аспектируемых классов в точке соединения (join point) и внедряет туда известную ему
функциональность (программный код).

## Виды advice

1. **Before (Перед):**  `@Before`- выполняется перед методом
2. **After (После):** `@After` - выполняется перед методом
3. **After Returning(После возврата):** `@AfterReturning` - выполняется только в случае успешного завершения метода
4. **After Throwing (После бросания):** `@AfterThrowing` - выполняется только в случае Exception
5. **Around (Вокруг):** `@Around`  - выполняется до, после и ... вместо метода


## Подключение

Spring Boot использует библиотеку *AspectJ*

## Создание простейшего аспекта

1. Создаем класс и помечаем его аннотациями `@Aspect` и `@Component`  
   Первая - говорит о том, что класс является аспектом, вторая - делает его бином.   
   Имя создаваемого класса не имеет значения

2. Создаем метод реализующий необходимый функционал, и помечаем его одной из следующих аннотаций:
    * `@Before`
    * `@After`
    * `@AfterReturning`
    * `@AfterThrowing`
    * `@Around`

3. В параметрах аннотации (параметр value) указываем *pointcut expression* - строка, которая определяет,
   в какие методы нашего приложения необходимо внедрить аспект

### Уровни логирования:

- TRACE - наиболее подробный уровень логирования. Значения переменных, шаги выполнения программы и т.п. Используется для отладки.
- DEBUG - для логирования значений наиболее важных переменных и другой информации, которая может быть важна для анализа причин возникновения ошибок.
- INFO - для логирования важных событий, происходящих в процессе работы приложения. Например, при отправке запросов в БД и http-запросов и полученных ответов, старте определённых этапов выполнения программы и т.п.
- WARN - предупреждения о каких-либо нештатных ситуациях, неправильном использовании приложения, на которые следует обратить внимание. Обычно такие ситуации не требуют внесения исправлений в код.
- ERROR - ошибки, которые могут привести к некорректной работе программы. Такие ситуации требуют вмешательства и внесения исправлений в код.
- FATAL - критические ошибки, серьёзные сбои, которые могут привести к немедленному аварийному завершению работы программы. Требуют немедленного вмешательства и исправления.
- OFF - логирование отключено.